ec.pkg("ec.member.myAddress");ec.load("ajax");ec.load("ec.box");ec.load("ec.linkSelect.region");ec.load("ec.dh");ec.load("ec.aes");ec.load("ec.rc4");ec.member.myAddress.data={};ec.member.myAddress.list=function(a,d){var c,b=[];$("#randomFlag").val(d);if(a.length<0){$("#myAddress-record").hide();return}for(c=0;c<a.length;c++){ec.member.myAddress.data[a[c].id]=a[c];b.push('<div class="list-group-item" id="myAddress-area-'+ec.util.escapeHtml(a[c].id)+'">');b.push('<table border="0" cellpadding="0" cellspacing="0">');b.push("<tbody><tr>");b.push('<td class="col-name">'+ec.util.escapeHtml(a[c].consignee)+"</td>");if(a[c].provinceName==null){a[c].provinceName="  "}if(a[c].cityName==null){a[c].cityName="  "}if(a[c].districtName==null){a[c].districtName="  "}b.push('<td class="col-address">'+ec.util.escapeHtml(a[c].provinceName)+"&nbsp;&nbsp;"+ec.util.escapeHtml(a[c].cityName)+"&nbsp;&nbsp;"+ec.util.escapeHtml(a[c].districtName)+"&nbsp;&nbsp;");if(a[c].streetName!=null&&a[c].streetName!=""){b.push(ec.util.escapeHtml(a[c].streetName)+"&nbsp;&nbsp;")}b.push(ec.util.escapeHtml(a[c].address)+"</td>");b.push('<td class="col-zip">');if(a[c].zipCode){b.push(ec.util.escapeHtml(a[c].zipCode))}b.push("</td>");b.push('<td class="col-tel">');if(a[c].mobile&&a[c].mobile!=""){b.push("<p>"+ec.util.escapeHtml(a[c].mobile)+"</p>")}if(a[c].phone&&a[c].phone!=""){b.push("<p>"+ec.util.escapeHtml(a[c].phone)+"</p>")}b.push("</td>");b.push('<td class="col-operate"><p class="p-edit">');b.push('<a class="edit" href="javascript:;" onclick="ec.member.myAddress.edit('+ec.util.escapeHtml(a[c].id)+');" title="编辑"><span>编辑</span></a>');b.push('</p><p class="p-del">');b.push('<a class="del" href="javascript:;" onclick="ec.member.myAddress.del(this,'+ec.util.escapeHtml(a[c].id)+');" title="删除"><span>删除</span></a>');b.push('</p><p class="p-state">');if(a[c].defaultFlag==1){ec.member.myAddress.defaultId=a[c].id;b.push('<span class="default">默认地址</span>')}else{b.push('<a class="set " href="javascript:;" onclick="ec.member.myAddress.setDefault('+ec.util.escapeHtml(a[c].id)+')" title="设为默认收货地址"><span>设为默认</span></a>')}b.push("</p></td></tr></tbody></table></div>")}$("#list-group").html(b.join(""));$("#myAddress-record").show()};ec.member.myAddress.save=function(c){var a=$(c);var b="update";if(a.attr("data-type")=="add"){b="add"}ec.addr.save(c,{type:b,successFunction:function(){var e=a.find("input[name=id]").val();var d=$("#button-ok").val();$("#current-address").removeClass("form-address-detailcon").addClass("form-address-detail");new ec.box($("#success-tips").val(),{boxclass:"ol_box_4",showCancel:false,onopen:function(f){if(d=="添加新地址"){f.find(".box-right-1 span").html("恭喜您，已成功添加新地址！")}else{f.find(".box-right-1 span").html("恭喜您，已修改成功！")}$("#consignee-msg").removeClass("report-errors filter");$("#address-msg").removeClass("report-errors filter");f.setPosition()},onok:function(f){f.close()},onclose:function(){ec.member.myAddress.reset();ec.addr.list(ec.member.myAddress.list)}}).open()}});return false};ec.member.myAddress.edit=function(e){$("#myAddress-form #tel-msg").text("");var a,c=ec.member.myAddress.data[e],b=ec.member.myAddress.data.length;$("html,body").animate({scrollTop:$("#myAddress-edit").offset().top},200);$("#myAddress-form").removeAttr("data-type");$("#consignee").val(c.consignee);var d="";if(c.street!=""&&c.street!=null){d=c.street}else{d=c.district}ec.address.setValue(c);ec.address.queryData(ec.address.parseUrl(tree_url,d),true,1,ec.address.getCitydistrict);$("#id").val(c.id);$("#address").val(c.address);$("#address").prevAll("label").hide();$("#phone").prevAll("label").hide();$("#mobile").prevAll("label").hide();$("#zipCode").val(c.zipCode);$("#mobile").val(c.mobile);$("#phone").val(c.phone);$("#button-ok").val("确  定");$("#button-cancel span").html("取&nbsp;&nbsp;消");if(c.id==ec.member.myAddress.defaultId){$("#myAddress-default").attr("checked",true).attr("disabled",true)}else{$("#myAddress-default").attr("checked",false).attr("disabled",false)}$("#myAddress-form input").removeClass("error");$("#myAddress-form label.label-error").removeClass("label-error");$("#myAddress-msg").removeClass("label-error");$("#myAddress-msg").hide();$("#address-msg").removeClass("label-error");$("#address-msg").html("");$("#address").removeClass("error");$("#needL4Addr").val(c.needL4Addr)};ec.member.myAddress.reset=function(){$("#myAddress-form")[0].reset();ec.address.setDefaultAddress();$("#myAddress-form").attr("data-type","add");$("#button-ok").val("添加新地址");$("#button-cancel span").html("清&nbsp;&nbsp;空");$("#myAddress-form input").removeClass("error");$("#myAddress-default").attr("checked",false).attr("disabled",false);$("#myAddress-form label.label-error").text("");$("#myAddress-form #tel-msg").text("");$("#myAddress-form label.label-error").removeClass("label-error");$("#myAddress-msg").removeClass("icon-error");$("#myAddress-msg").hide();$("#consignee-msg").removeClass("report-errors filter");$("#address-msg").removeClass("report-errors filter");ec.address.defaultTabValue();ec.address.cleanValue();$("#current-address").removeClass("form-address-detailcon").addClass("form-address-detail");ec.address.cleanFormValue()};ec.member.myAddress.del=function(a,b){if(!ec.ui.confirm(a,"您确认要删除该地址吗？")){return}ec.addr.del(b,{deleteDefault:ec.member.myAddress.changeDefaultId,successFunction:function(c){$("#myAddress-area-"+c).remove()}})};ec.member.myAddress.setDefault=function(a){ec.addr.setDefault(a,{successFunction:ec.member.myAddress.changeDefaultId})};ec.member.myAddress.changeDefaultId=function(a){$("#myAddress-area-"+a).find(".p-state").html("<span class='default'>默认地址</span>");$("#myAddress-area-"+ec.member.myAddress.defaultId).find(".p-state").html('<a class="set " href="javascript:;" onclick="ec.member.myAddress.setDefault('+ec.member.myAddress.defaultId+')" title="设为默认收货地址"><span>设为默认</span></a>');if(ec.member.myAddress.defaultId!=a){$("#address-form-"+ec.member.myAddress.defaultId+" input[name=defaultFlag]").attr("checked",false).attr("disabled",false)}ec.member.myAddress.defaultId=a};ec.member.myAddress.bind=function(){form=$("#myAddress-form");var g=ec.form.validator.bind,f=form.find("input[name=consignee]"),e=form.find("input[name=zipCode]"),c=form.find("textarea[name=address]"),b=form.find("input[name=phone]"),d=form.find("input[name=mobile]"),a=form.find("input[name=district]");checkPhone=function(i,h){var i=(i.attr("name")==="mobile")?d:b,j=$(h.msg_ct);if($.trim(d.val()).length==0){d.addClass("error");$("#tel-msg").addClass("label-error");$("#tel-msg").html("手机号码不能为空")}else{if($.trim(i.val()).length>0&&i.hasClass("error")){return}else{if(d.hasClass("error")){$("#tel-msg").text("请填写正确的11位手机号码，例如：13XXXXXXXXX")}if(b.hasClass("error")){$("#tel-msg").text("请填写正确的备选号码，固话格式为区号-主机-分机号")}if(!d.hasClass("error")&&!b.hasClass("error")){$("#tel-msg").removeClass("label-error");$("#tel-msg").text("")}}}};currentCheckAddress=function(m,j){var i=$("#myAddress-form"),h=i.find("input[name=province]").val(),n=i.find("input[name=city]").val(),o=i.find("input[name=street]").val(),l=i.find("input[name=district]").val(),k=i.find("input[name=needL4Addr]").val();if($.trim($("#current-address").html())=="选择省-市-区-街道"){$("#myAddress-msg").addClass("icon-error label-error");$("#myAddress-msg").html("请填写完整的地区信息")}else{if(""!=h&&""!=n&&""!=l){if(k=="true"&&o==""){$("#myAddress-msg").addClass("icon-error label-error");$("#myAddress-msg").html("请填写完整的地区信息")}else{$("#myAddress-msg").removeClass("icon-error");$("#myAddress-msg").removeClass("label-error");$("#myAddress-msg").html("")}}else{$("#myAddress-msg").removeClass("icon-error");$("#myAddress-msg").removeClass("label-error");$("#myAddress-msg").html("")}}};g(f,{type:["require","length","regex"],validOnChange:true,regex:/^[\uFF21-\uFF3A\uFF41-\uFF5A\u4E00-\u9FA5\s\u3000A-Za-z]+$/,min:2,max:20,msg_ct:"#"+f.attr("id")+"-msg",autoFocus:true,msg:{"default":"",length:"收货人长度为2-20个字符，一个汉字为两个字符",regex:"收货人只能填写中文和英文字符",require:"请填写收货人"}});g(a,{type:["addressCheck"],validOnChange:true,msg_ct:"#myAddress-msg",autoFocus:true,msg:{"default":"请填写完整的地区信息"},successFunction:currentCheckAddress});g(c,{type:["require","length","forbidChar2"],validOnChange:true,max:100,msg_ct:"#"+c.attr("id")+"-msg",autoFocus:true,msg:{forbidChar2:"收货人详细地址中含有非法字符",length:"详细地址最长为100个字符，一个汉字为两个字符",require:"请填写详细地址"}});g(e,{type:["length","int"],validOnChange:true,min:6,max:6,msg_ct:"#"+e.attr("id")+"-msg",autoFocus:true,msg:{"default":"请填写正确的邮编"}});g(d,{type:["mobile"],validOnChange:true,msg_ct:"#"+d.attr("alt"),autoFocus:true,msg:{"default":"请填写正确的11位手机号码，例如：13XXXXXXXXX"},successFunction:checkPhone});g(b,{type:["mobleOrPhone"],validOnChange:true,msg_ct:"#"+b.attr("alt"),autoFocus:true,msg:{"default":"请填写正确的备选号码，固话格式为区号-主机-分机号"},successFunction:checkPhone});ec.form.input.label(c,"如选择不到您的地区，请在此处详细描述").label(b,"固话或其他手机号码").label(d,"请输入11位手机号码")};$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:false,errorFunction:function(c,a){var b="label-error",d=a.msg[a.type]||a.msg["default"];d=(d.length<=0)?"&nbsp;":d;switch(a.type){case"require":b="label-error";break}if(a.msg_ct){$(a.msg_ct).addClass("label-error").html(d)}else{var e=(c.attr("id")||c.attr("name"))+"-msg";$("#"+e).remove();c.after("<label id='"+e+"' class='label-error "+b+"'>"+d+"</label>")}if(a.autoFocus){c.focus()}},successFunction:function(b,a){if(!$(a.msg_ct).hasClass("filter")){if(a.msg_ct){$(a.msg_ct).html("").removeClass("label-error")}else{$("#"+(b.attr("id")||b.attr("name"))+"-msg").remove()}}}});ec.ready(function(){$("#li-myAddress").addClass("current");$("#pathTitle").html("收货地址管理");ec.addr.list(ec.member.myAddress.list);if(ec.isIE6){$(".list-group-item").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}ec.member.myAddress.bind();new ec.address.oSearchSuggest(ec.address.sendKeyWordToBack);$("#current-address").click(function(){if($("#gouldAddress").val()==0){ec.address.processAddress()}else{$("#address-search").show()}});$(".btn-address-close").click(function(){ec.address.hiddenTips()});$(".form-address-search-text a").click(function(){ec.address.cleanKeyWord()})});
ec.pkg("ec.order");ec.load("ec.box");ec.load("ec.dh");ec.load("ec.aes");ec.load("ec.rc4");var selectAddrId="";var _defaultTimeOut=10000;ec.order.selectAddress=function(c,b){if(ec.order.isSupportDisTime=="0"){return}var a=$("#orderType").val();if(a==18){return}ec.order.processSupportDisplayDilieryTime()};ec.order.processSupportDisplayDilieryTime=function(){if($(".order-main").find("ul").eq(0).find("a").eq(0).text().trim().substring(0,2)=="套餐"){ec.order.hiddenTips();return}if(ec.order.shippingDate!=""&&ec.order.shippingDate!=undefined){$("#order_confirm_tipsMsg").html(ec.order.shippingDate);$("#order_confirm_tips").html("<b>订单按照支付顺序发货，预计发货时间在支付全部完成前可能变更；预计发货时间根据商品库存信息计算得出，受诸多因素影响可能会产生偏差，我们会为您积极备货。</b>");ec.order.showTips();return}if(ec.order.isSupportDisTime=="0"){return}ec.order.hiddenTips();ec.order.processExpectDelivery()};ec.order.processExpectDelivery=function(){if(ec.order.shopCode!=ec.order.productSeCode||ec.order.isAllPrdVirtual=="true"){return}if(ec.order.shippingDate!=""&&ec.order.shippingDate!=undefined){$("#order_confirm_tipsMsg").html(ec.order.shippingDate);$("#order_confirm_tips").html("<b>订单按照支付顺序发货，预计发货时间在支付全部完成前可能变更；预计发货时间根据商品库存信息计算得出，受诸多因素影响可能会产生偏差，我们会为您积极备货。</b>");ec.order.showTips();return}selectAddrId=$("#order-address-list li.current input[name='myAddress']").attr("data-district");if(selectAddrId==""){return}var f=$("#order-titleTypeVMALL-HUAWEIDEVICE").val();if(f==null||f==""){f="1"}var c=$("#order-price-VMALL-HUAWEIDEVICE").html();if(c==null){c=""}var e=$(".skuCodeQuanClass");var a="";var d="";for(var b=0;b<e.length;b++){if(b!=e.length-1){a+=e[b].id+",";d+=e[b].value+","}else{a+=e[b].id;d+=e[b].value}}ec.prescription.getEstimateGetOrderTime2(ec.order.showSupportDisplayDilieryTime,selectAddrId,c,f,a,d)};ec.order.showSupportDisplayDilieryTimeTemp=function(e,i,d,h,b){var g="";if(!b){var a="";var f="";if(h=="1"){a=i;f="今天"}else{a=d;f="明天"}var c=ec.order.getEffectivenessTime(a,e);g=f+e+"前付款，预计"+c+"送达"}$("#order_confirm_tipsMsg").html(g);if(null!=e&&e!=""){ec.order.showTips()}else{ec.order.hiddenTips()}if(b){$("#order_confirm_tips").hide()}};ec.order.showSupportDisplayDilieryTime=function(f,g){var a="";if(!g){if(f.info){var b=f.info.deadlineTime;var e="";var c="";if(f.beforeAndAfterFlag=="1"){e=f.info.earlyArrivalTime;c="今天"}else{e=f.info.lateArrivalTime;c="明天"}var d=ec.order.getEffectivenessTime(e,b);a=c+b+"前付款，预计"+d+"送达"}}$("#order_confirm_tipsMsg").html(a);if(null!=f.info&&f.info!=""){ec.order.showTips()}else{ec.order.hiddenTips()}if(g){$("#order_confirm_tips").hide()}};ec.order.newCount=function(){var b=0;var c=$("#orderType").val();if(c==18&&ec.order.balancePrice!=0){b=((ec.order.totalOriginalPrice||0)+(ec.order.deliveryCharge||0)-(ec.order.couponDiscount||0)-(ec.order.depositAmount||0)-(ec.order.depositDiscount||0)-(ec.order.petalAmount||0)-(ec.order.pointAmount||0)).toFixed(2);$("#balanceAmountIDD").html(b)}else{ec.order.totalPrice=(ec.order.totalOriginalPrice+(ec.order.deliveryCharge||0)-(ec.order.discountTotalPrice||0)-(ec.order.couponDiscount||0)-(ec.order.petalAmount||0)-(ec.order.pointAmount||0)).toFixed(2);var a=0;$("input[id^='coupon-first-']").each(function(){if($(this).val()!=undefined&&$(this).val()!=""){var d=$(this).val().split("|");a=a+parseFloat(d[3])}});b=((ec.order.allTotalOriginalPrice||0)+(ec.order.deliveryCharge||0)-(ec.order.allTotalDiscountPrice||0)-(ec.order.couponDiscount||0)-(ec.order.petalAmount||0)-(ec.order.pointAmount||0)-a).toFixed(2)}if(ec.order.totalPrice<0){ec.order.totalPrice=0}$("#order-price-VMALL-HUAWEIDEVICE").html(ec.order.totalPrice).attr("data-oldval",ec.order.totalPrice);if(b<0){b=0}$("#payableTotal").html(b)};ec.order.hiddenTips=function(){$("#order_confirm_tipsMsg").hide();$("#order_confirm_sp_tips").hide();$("#order_confirm_tips").hide()};ec.order.showTips=function(){$("#order_confirm_tipsMsg").show();$("#order_confirm_sp_tips").show();$("#order_confirm_tips").css("display","inline-block")};ec.order.getEffectivenessTime=function(b,c){var f;var e=ec.order.getSysDate();var h=e.getHours();var d=e.getTime();var g=new Date();g.setTime(d);c=c.substring(0,2);if(h>=0&&h<c){g.setHours(parseInt(c)+parseInt(b))}else{g.setHours(parseInt(c)+parseInt(b))}var a=(parseInt(g.getMonth())+1)+"月"+g.getDate()+"日（"+ec.order.getWeekByTime(g)+"）";return a};ec.order.getWeekByTime=function(a){var c=a.getDay();var e="";switch(c){case 0:e="周日";break;case 1:e="周一";break;case 2:e="周二";break;case 3:e="周三";break;case 4:e="周四";break;case 5:e="周五";break;case 6:e="周六";break}var d=new Date();var b=d.diff(a);if(b==0){e="今天"}if(b==1){e="明天"}return e};Date.prototype.diff=function(a){return Math.floor((a.getTime()-new Date(new Date().setHours(0,0,0,0)).getTime())/(24*60*60*1000))};ec.order.getSysDate=function(){var a=new Date();new ec.ajax().get({async:false,url:"/system/getSysDate.json",timeout:_defaultTimeOut,successFunction:function(b){if(!ec.util.isEmpty(b.now)){a.setTime(b.now.parseDate("yyyy-MM-dd HH:mm:ss"))}}});return a};
ec.pkg("ec.search");ec.load("ec.pager");ec.load("ajax",{loadType:"lazy"});ec.search.sortField="";ec.search.sortType="desc";ec.search.keyword;ec.product.pageNumber=1;ec.search.upLoadBI=function(p,b,f){var d="";var a=ec.search.keyword;var g=f+(p-1)*b+1;var c=new Date();var j=c.getMonth()+1;var o=c.getDate();var n=c.getHours();var e=c.getMinutes();var q=c.getSeconds();if(j>=1&&j<=9){j="0"+j}if(o>=0&&o<=9){o="0"+o}if(n>=0&&n<=9){n="0"+n}if(e>=0&&e<=9){e="0"+e}if(q>=0&&q<=9){q="0"+q}var m=c.getFullYear()+j+o+n+e+q;if(ec.search.sortField=="register_date"){d="newes"}else{if(ec.search.sortField=="sale_number"){d="popularity"}else{if(ec.search.sortField=="price"){if(ec.search.sortType=="desc"){d="pricedown"}else{d="priceup"}}else{d="relevance"}}}var h=$("#itemdata_"+f).attr("itemid");var l=$("#itemdata_"+f).attr("itemname");var k=$("#itemdata_"+f).attr("skuid")};ec.search.sort=function(b,d){var a=ec.search.sortField,e=ec.search.sortType,c;switch(b){case"price":if(b==a){$("#sort-"+b).attr("class",e=="desc"?"sort-asc":"sort-desc");c=e=="desc"?"asc":"desc"}else{$("#sort-"+b).addClass("sort-desc").siblings().removeClass();c="desc"}break;default:$("#"+d).addClass("selected").siblings().removeClass("selected");$("#sort-price").removeClass("sort-asc sort-desc");c="desc";break}ec.search.sortType=c;ec.search.sortField=b;ec.search.load()};ec.search.load=function(a){var b=ec.search.pageNumber=(a?a.pageNumber:ec.product.pageNumber);ec.Cache.get("search_ajaxer",function(){return new ec.ajax()}).get({url:"/search/"+encodeURIComponent(ec.search.keyword)+".json?pageNumber="+b+"&"+ec.search.sortField+"="+ec.search.sortType,timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(f){if(!f.success){alert("\u8bfb\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01")}var e=[],g;var c=0;for(var d=0;d<f.prdList.length;d++){g=f.prdList[d];g.price=(g.priceMode==2)?"<b>\u6682\u65e0\u62a5\u4ef7</b>":"<b>&yen;"+g.priceStr+"</b>";e.push('<li><div class="pro-panels ">');e.push('<input type="hidden" id="itemdata_'+(c++)+'" skuid="'+g.skuId+'" itemid="'+g.id+'" itemname="'+safeStr(g.name)+'" />');e.push('<a href="/product/'+g.id+".html#"+g.skuId+'" target="_blank" onclick="ec.search.upLoadBI('+f.page.pageNumber+","+f.page.pageSize+","+d+");pushSearchProMsg('"+g.id+"','"+g.name+"','"+g.skuId+"','"+(d+1)+"')\">");e.push('<p class="p-img"><img src="'+safeStr(ec.mediaPath)+safeStr(g.photoPath)+"428_428_"+safeStr(g.photoName)+'" alt="'+safeStr(g.briefName)+'"/></p>');e.push('<p class="p-name" title="'+safeStr(g.skuName)+'">'+safeStr(g.skuName)+"</p>");e.push('<p class="p-price">'+g.price);if(g.skuCount>1){e.push("<span>\u591a\u914d\u7f6e\u53ef\u9009</span>")}e.push("</p>");if(safeStr(g.tagPhotoName)!=undefined&&safeStr(g.tagPhotoName)!=""){e.push('<s class="p-tag"><img src="'+ec.mediaPath+safeStr(g.tagPhotoPath)+safeStr(g.tagPhotoName)+'"/></s>')}e.push("</a></div></li>")}$("#pro-list").html(e.join(""));ec.ui.scrollTo("#ct-list");ec.search.renderPage(f.page)}})};ec.search.renderPage=function(a){if(!a.totalPage||a.totalPage==1){return}$("#search-pager").pager({pageNumber:a.pageNumber,pageCount:a.totalPage,recordCount:a.totalRow,qpageSize:5,text:{first:"|&lt;",pre:"&lt",next:"&gt;",last:"&gt;|"},item:["first","pre","qpage","next","last","quickPager"],callBack:ec.search.load})};function safeStr(a){if(a==null){return}return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};

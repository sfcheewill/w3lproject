ec.pkg("ec.member.orderDetails");ec.load("ec.box");ec.load("ec.dh");ec.load("ec.aes");ec.load("ec.rc4");var selectAddrId="";ec.member.orderDetails.processSupportDisplayDilieryTime=function(a,b){ec.member.orderDetails.hiddenTips();ec.member.orderDetails.optExpectDelivery(a,b)};ec.member.orderDetails.optExpectDelivery=function(b,d){if(ec.member.orderDetails.shopCode!=ec.member.productSeCode||ec.member.isAllVirture=="true"||ec.member.orderDetails.orderStatus=="7"||ec.member.orderDetails.orderStatus=="8"){return}if(parseInt(ec.member.orderDetails.orderType)!=0&&parseInt(ec.member.orderDetails.orderType)!=16){return}selectAddrId=ec.member.orderDetails.district;var f=ec.member.orderDetails.titleType;if(f==null||f==""){f="1"}var c=$.trim($(".order-pro-cost-total").find("span").html());if(c.indexOf("¥")!=-1){c=c.substring(1)}if(c=="暂无报价"){c=""}var a=ec.member.orderDetails.paymentStatus;var e=ec.member.orderDetails.arrivalDate;if(a==1){if($("#PIDD-INFO").val()=="P"){ec.member.orderDetails.hiddenTips();return}if(e!=""){ec.member.orderDetails.arrivalDateInfo(e)}}else{ec.prescription.queryPreDeliveryAndArrival(ec.member.orderDetails.showSupportDisplayDilieryTime,selectAddrId,c,f,b)}};ec.member.orderDetails.arrivalDateInfo=function(c){var a="";var b=ec.member.orderDetails.getEffectivenessTimeInfo(c);a="(预计"+b+"送达)";$("#order_detail_expected_delivery").html(a);ec.member.orderDetails.showTips()};ec.member.orderDetails.getEffectivenessTimeInfo=function(c){var b=new Date(c.replace(/-/g,"/"));var a=(parseInt(b.getMonth())+1)+"月"+b.getDate()+"日("+ec.member.orderDetails.getWeekByTime(b)+")";return a};ec.member.orderDetails.showSupportDisplayDilieryTime=function(j,c){var h="";if(!c){if(j&&j.success){var b=j.info;if(b.shippingDate&&b.shippingDate.length>0){h=b.shippingDate;if($("#PIDD-INFO").val()=="P"){return}var d=$("#orderType").val();$("#order_detail_expected_delivery").before('<span id="shippingDateIDD">（'+h+"，受付款完成时间等因素可能发生变化）</span>");$("#order_detail_expected_delivery").before("&nbsp;&nbsp;");$("#order_detail_expected_delivery").before('<em class="tips-common"><div class="tips-common-detail"><b>订单按照支付顺序发货，预计发货时间在支付全部完成前可能变更；预计发货时间根据商品库存信息计算得出，受诸多因素影响可能会产生偏差，我们会为您积极备货。</b></div></em>');return}else{if(b.estimatedArrivalTime!=null&&b.estimatedArrivalTime!=""){var i=b.estimatedArrivalTime;var f=i.deadlineTime;var a="";var g="";if(j.beforeAndAfterFlag=="1"){a=i.earlyArrivalTime;g="今天"}else{a=i.lateArrivalTime;g="明天"}var e=ec.member.orderDetails.getEffectivenessTime(a,f,i);if(ec.member.orderDetails.paymentStatus==1){h="(预计"+e+"送达)"}else{h="("+g+i.deadlineTime+"前付款，预计"+e+"送达,受付款完成时间等因素可能发生变化)"}}}}}$("#order_detail_expected_delivery").html(h);if(null!=j.info.estimatedArrivalTime&&j.info.estimatedArrivalTime!=""){ec.member.orderDetails.showTips()}else{ec.member.orderDetails.hiddenTips()}if($("#PIDD-INFO").val()=="P"){ec.member.orderDetails.hiddenTips()}if(c){ec.member.orderDetails.hiddenTips()}};ec.member.orderDetails.showAddress=function(a){$("#address").find("a").html(a[0]+"-"+a[1]+"-"+a[2])};ec.member.orderDetails.hiddenTips=function(){$("#order_detail_expected_delivery").hide();$("#order_detail_expected_delivery_tips").hide()};ec.member.orderDetails.showTips=function(){$("#order_detail_expected_delivery").show();$("#order_detail_expected_delivery_tips").show()};ec.member.orderDetails.getEffectivenessTime=function(g,f,a){var d;var c=ec.member.orderDetails.getSysDate();f=f.substring(0,2);f=parseInt(f);if(ec.member.orderDetails.paymentStatus==1){c=new Date(ec.member.orderDetails.paymentTime.replaceAll("-","/"));var e=c.getHours();if(parseInt(e)<f){g=a.earlyArrivalTime}else{g=a.lateArrivalTime}}var b=c.getTime();var i=new Date();i.setTime(b);i.setHours(parseInt(f)+g);var h=(parseInt(i.getMonth())+1)+"月"+i.getDate()+"日("+ec.member.orderDetails.getWeekByTime(i)+")";return h};ec.member.orderDetails.getWeekByTime=function(a){var c=a.getDay();var e="";switch(c){case 0:e="周日";break;case 1:e="周一";break;case 2:e="周二";break;case 3:e="周三";break;case 4:e="周四";break;case 5:e="周五";break;case 6:e="周六";break}var d=new Date();var b=d.diff(a);if(b==0){e="今天"}if(b==1){e="明天"}return e};Date.prototype.diff=function(a){return Math.floor((a.getTime()-new Date(new Date().setHours(0,0,0,0)).getTime())/(24*60*60*1000))};ec.member.orderDetails.getSysDate=function(){var a=new Date();new ec.ajax().get({async:false,url:"/system/getSysDate.json",timeout:10000,successFunction:function(b){if(!ec.util.isEmpty(b.now)){a.setTime(b.now.parseDate("yyyy-MM-dd HH:mm:ss"))}}});return a};
ec.pkg("ec.member.msg");ec.load("ajax",{loadType:"lazy"});ec.load("ec.pager");ec.member.msg.pageNumber=1;ec.ready(function(){$("#li-msg").css("color","#ca141d");$("#li-msg em").css("color","#ca141d");$("#pathTitle").html("\u7ad9\u5185\u4fe1");$("#ec_ui_confirm").click(function(a){a=a||window.event;a.stopPropagation()});$(document).bind("click",function(b){var b=b||window.event;var a=b.target||b.srcElement;if(a.innerHTML!="\u5220\u9664"){$("#ec_ui_confirm").hide()}})});ec.member.msg.load=function(b){var c,a;if($("#msgType").val()=="msg"){c="/member/msg.json";a="\u5bf9\u4e0d\u8d77\uff0c\u60a8\u6682\u65f6\u6ca1\u6709\u7ad9\u5185\u4fe1\u606f\uff01"}else{c="/member/ineractMsg.json";a="\u5bf9\u4e0d\u8d77\uff0c\u60a8\u6682\u65f6\u6ca1\u6709\u4e92\u52a8\u4fe1\u606f\uff01"}new ec.ajax().submit({url:c,data:{pageNumber:b.pageNumber,pageCount:b.pageCount,recordCount:b.recordCount,pageSize:b.pageSize},timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(g){if($("#msgType").val()=="msg"){if(!g.success){if(g.messageList==null&&g.msg==null){g.msg="\u5f53\u524d\u767b\u5f55\u5df2\u5931\u6548"}ec.showError(g);return}var f=[],k;for(var e=0;e<g.messageList.length;e++){k=g.messageList[e];title=ec.util.escapeHtml(k.title);var d,h;if((k.type=="3"||k.type=="4")&&k.receiveStatus=="0"){f.push('<div class="list-group-item unread">')}else{f.push('<div class="list-group-item read">')}f.push('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>');f.push('<td class="col-type"><i></i><span>');if(k.type=="1"){f.push("\u516c\u544a")}else{if(k.type=="2"){f.push("\u901a\u77e5")}else{if(k.type=="3"){f.push("\u4e92\u52a8")}else{if(k.type=="4"){f.push("\u8bc4\u8bba")}else{f.push("\u5176\u5b83")}}}}f.push('</span></td><td class="col-title">');if((k.type=="3"||k.type=="4")&&k.receiveStatus=="0"){f.push('<a class="read" href="/member/msg-'+k.id+"?uid="+k.receiverId+'" title="'+title+'" target="_blank">')}else{f.push('<a href="/member/msg-'+k.id+"?uid="+k.receiverId+'" title="'+title+'" target="_blank">')}f.push(title);f.push('</a></td><td class="col-date">');f.push((new Date(k.sendtime)).format("yyyy-MM-dd HH:mm:ss"));f.push('</td><td class="col-operate">');if(k.type=="3"||k.type=="4"){f.push('<p><a class="del" href="javascript:;" onclick="ec.member.msg.deleteMsg(this,'+k.id+');" title="\u5220\u9664"><span>\u5220\u9664</span></a></p>')}f.push("</td></tr></tbody></table></div>")}}else{if(!g.success){if(g.Interacts==null&&g.msg==null){g.msg="\u5f53\u524d\u767b\u5f55\u5df2\u5931\u6548"}ec.showError(g);return}var f=[],k;for(var e=0;e<g.Interacts.length;e++){k=g.Interacts[e];var l=JSON.parse(k.content);title=ec.util.escapeHtml(k.title);var d,h;if(k.receiveStatus=="0"){f.push('<div class="list-group-item unread">')}else{f.push('<div class="list-group-item read">')}f.push('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr>');f.push('<td class="col-type"><i></i><span>');f.push(title);f.push('</span></td><td class="col-title">');f.push('<a class="read" onclick="ec.member.msg.updateIneractMsg(this,'+k.id+',1);"  href="/product/viewReply/'+l.msg.pid+"/"+l.msg.rmsId+"?t="+new Date().getTime()+'" target="_blank">');f.push(l.msg.content);f.push('</a></td><td class="col-date">');f.push((new Date(k.createTime)).format("yyyy-MM-dd HH:mm:ss"));f.push('</td><td class="col-operate">');f.push('<p><a class="del" href="javascript:;" onclick="ec.member.msg.updateIneractMsg(this,'+k.id+',2);" title="\u5220\u9664"><span>\u5220\u9664</span></a></p>');f.push("</td></tr></tbody></table></div>")}}$("#list-group").html(f.join(""));if(g.page.totalPage<g.page.pageNumber){var j={pageNumber:g.page.totalPage};ec.member.msg.load(j);return}if(g.page.totalRow==0){$("#list-group").html('<div class="inform-empty-area">'+a+"</div>").removeClass("inform-list");ec.member.msg.renderPage(g.page);return}else{ec.member.msg.renderPage(g.page)}ec.ui.scrollTo("#list-group-title")}})};ec.member.msg.check=function(c,b){if($(c).parent("li").hasClass("current")){return}$("#msgType").val(b);var a={pageNumber:1};ec.member.msg.load(a);$(c).parent("li").addClass("current").siblings().removeClass("current")};ec.member.msg.renderPage=function(a){if(a.totalPage<=1){$(".list-group-page").hide();return}else{$(".list-group-page").show()}ec.member.msg.pageNumber=a.pageNumber;$("#list-pager").pager({pageNumber:a.pageNumber,pageCount:a.totalPage,pageSize:10,text:{first:"|&lt;",pre:"&lt",next:"&gt;",last:"&gt;|"},item:["first","pre","qpage","next","last","quickPager"],callBack:ec.member.msg.load})};ec.member.msg.deleteMsg=function(b,a){if(!ec.ui.confirm(b,"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u5417\uff1f")){return}new ec.ajax().submit({url:"/member/msg/del-"+a+".json",timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(d){if(!d.success){if(JSON.stringify(d)=="{}"){d.msg="\u5f53\u524d\u767b\u5f55\u5df2\u5931\u6548"}ec.showError(d);return}var f={pageNumber:ec.member.msg.pageNumber};ec.member.msg.load(f);if(d.isRead==0){var c=ec.util.cookie.get("vmallMyCenterMsg");var e=c-1;if(e>0){$("#li-msg em").text("("+(e)+")")}else{$("#li-msg em").text("")}ec.util.cookie.set("vmallMyCenterMsg",e)}}})};ec.member.msg.getUnReadMessageCount=function(){$.ajax({url:"/member/msg/unRead.json",timeout:10000,dataType:"json",success:function(b){if(!b.success){return}var a=b.count;if(a>0){$("#li-msg em").text("("+a+")")}ec.util.cookie.set("vmallMyCenterMsg",a)}})};ec.member.msg.updateIneractMsg=function(c,a,b){if(b==2){if(!ec.ui.confirm(c,"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u5417\uff1f")){return}}new ec.ajax().submit({url:"/member/ineractMsg/update-"+a+".json?isRead="+b,timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(e){if(!e.success){if(JSON.stringify(e)=="{}"){e.msg="\u5f53\u524d\u767b\u5f55\u5df2\u5931\u6548"}ec.showError(e);return}var g={pageNumber:ec.member.msg.pageNumber};ec.member.msg.load(g);if(e.isRead==0){var d=ec.util.cookie.get("vmallMyCenterMsg");var f=d-1;if(f>0){$("#li-msg em").text("("+(f)+")")}else{$("#li-msg em").text("")}ec.util.cookie.set("vmallMyCenterMsg",f)}}})};ec.ready(function(){ec.member.msg.getUnReadMessageCount()});
